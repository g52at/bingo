<!DOCTYPE html>
<html lang="ja">
<head></head>


<br>今の結果<p id="kekka"></p>
<br>前の結果<p id="before"></p><br>

<br><p id="test"></p>

<button id="start_animation">スタート！btn0</button>
<button id="bingo_botton">ストップ！btn1</button>
<button id="reset_botton" onclick="reset_check()">リセット</button>

<br>過去の結果<p id="logs"></p>


</body>
<script>
    var bingo_max = 20;//ビンゴの最大値
    var index = 0;
    var bingo_array;
    var before_bingo = 0;
    let bingo_botton = document.getElementById('bingo_botton').textContent;
    
    function randomizing(){//ビンゴの乱数を配列で出力
        var arr = [];
        bingo_array = []; 
        for(var i=0; i < bingo_max; i++){
            arr[i]=i+1;
        }
    
        for(var j = 0, len = arr.length; j < bingo_max; j++, len--) {
            rndNum = Math.floor(Math.random()*len);
            bingo_array.push(arr[rndNum]);
            arr[rndNum] = arr[len-1];
        }
        index = 0;
        console.log("bingo:リセット完了");
        document.getElementById("kekka").innerHTML = "準備完了！";
        document.getElementById("before").innerHTML = "準備完了！";
    }
//ビンゴのアニメーション
    let refleshlate = 10; //速度
    let text = document.getElementById('test').textContent; //置換元を宣言
    let i = 0;
    let timerId;
    var btn0 = document.getElementById('start_animation');
    var btn1 = document.getElementById('bingo_botton');

    btn0.addEventListener('click', () => {//アニメーションのスタート
        timerId = 0;
        sayHello();
    },{
      //  once: true
    });

    btn1.addEventListener('click',function(){//停止ボタン
        window.clearTimeout(timerId);
        get_bingo();
    });

    function sayHello() { //タイマー処理
        document.getElementById('test').textContent = i; //置換元のとこを書き換えてる
        timerId = setTimeout(sayHello, refleshlate);
        i++;
        if(i > 100){// 100を越えて暴走しないように
          i = 0;
        }
      }
    
    setTimeout(() => {//割り込みで停止
      clearTimeout(timerId);
    }, 500)

    function reset_bingo(){//リセット
      window.clearTimeout(timerId);
      document.getElementById('test').textContent = "リセットされました";
    }
//ビンゴスタート
    function get_bingo(){//ビンゴのメイン処理
        document.getElementById("kekka").innerHTML = bingo_array[index];
        if(bingo_array[index] === undefined){//今の抽選結果
            alert("抽選終了！");
            document.getElementById("kekka").innerHTML = "抽選終了！";
        }else{  //当選したログを表示
            const bingo_log_base = document.getElementById("logs");
            const bingo_log_element = document.createElement("li");
            const textnode = document.createTextNode(bingo_array[index]);
            bingo_log_element.appendChild(textnode);
            bingo_log_base.appendChild(bingo_log_element);
        }
        if(!before_bingo == 0){//一つ前の抽選結果
            document.getElementById("before").innerHTML = before_bingo;
        }else{
            document.getElementById("before").innerHTML = "抽選中…";
        }
        //後の処理
        before_bingo = bingo_array[index];
        bingo_array.shift();
        if (bingo_array.length < index){
            document.getElementById("kekka").innerHTML = "全部出たはずです…"
        }
    }
    function reset_check(){//リセットボタンの動作
        if (confirm("ビンゴの中身をリセットしますか？")){
            randomizing();
            alert("リセット完了しました。")
            document.getElementById("kekka").innerHTML = "リセット完了！";
            document.getElementById("before").innerHTML = "リセット完了！";
            console.log("bingo:手動リセット完了")
        }
    }

/*アニメーションの実装
    var i = 0;
    var timerId = 0;
    function sayHello() { //タイマー処理
        if (!)
            document.getElementById('kekka').textContent = bingo_array[i]; //置換元のとこを書き換えてる
        timerId = setTimeout(sayHello, refleshlate);
        i++;
        if(i > 100){// 100を越えて暴走しないように
            i = 0;
        }
    }
    setTimeout(() => {//暴走対策、カウンターが一定以上でリミッターがかかる
      clearTimeout(timerId);
    }, 500)
    document.getElementById('kekka').addEventListener('click', () => {
        timerId = 0;
        sayHello();
    });

ここまで*/
    window.onload = randomizing();// 自動実行
    </script>
</html>